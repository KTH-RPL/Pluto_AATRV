<launch>
    <!-- ================================================================== -->
    <!-- Original Obstacle Detector Node -->
    <!-- ================================================================== -->
    <node name="corrected_robot_pose_publisher" pkg="detector" type="pose_corrector.py" output="screen"/>
    <!-- <node name="robot_pose_publisher" pkg="robot_controller" type="publishers1.py" output="screen"/> -->
    <node name="detector" pkg="detector" type="detector.py" output="screen">
        <!-- ... (detector parameters are unchanged) ... -->
        <param name="depth_topic"           value="/rsD455_node0/depth/image_rect_raw"/>
        <param name="obstacle_topic"        value="/detected_obstacles"/>
        <param name="output_frame_id"       value="base_footprint"/>
        <param name="safety_buffer"         value="0.1"/>
        <param name="depth_scale_factor"    value="1000.0"/>
        <rosparam param="uv_detector">
            row_downsample: 4
            col_scale: 0.5
            min_dist: 0.1
            max_dist: 8.0
            threshold_point: 3
            threshold_line: 2
            min_length_line: 6
        </rosparam>
        <rosparam param="depth_intrinsics">[392.1868, 393.0597, 323.7744, 236.8676]</rosparam>
        <rosparam param="body_to_camera_depth">[
            -0.002257, -0.000971,  0.999996,  0.068483,
             0.999962,  0.008356,  0.002265, -0.054542,
            -0.008358,  0.999964,  0.000952,  0.094245,
             0.0,       0.0,       0.0,       1.0
        ]</rosparam>
    </node>

    <!-- ================================================================== -->
    <!-- UPDATED: Costmap Generator Node with Gradient Inflation -->
    <!-- ================================================================== -->
    <node pkg="detector" type="costmap.py" name="global_costmap_generator" output="screen">
        <!-- Enable debug logging -->
        <!-- <env name="ROSCONSOLE_CONFIG_FILE" value="$(find your_package_name)/config/debug.config" /> -->
        <!-- Or set log level directly -->
        <!-- <param name="log_level" value="debug" /> -->
        <!-- Topics -->
        <param name="obstacle_topic" value="/detected_obstacles" />
        <param name="costmap_topic" value="/global_costmap" />
        <param name="robot_pose_topic" value="/robot_pose" />
        
        <!-- Frames -->
        <param name="global_frame" value="odom" />
        
        <!-- Costmap Properties -->
        <param name="map_size" value="20.0" />        <!-- Size of local window around robot (meters) -->
        <param name="resolution" value="0.1" />        <!-- Resolution (meters/cell) -->
        
        <!-- Inflation Parameters -->
        <param name="inflation_radius" value="0.5" />       <!-- Lethal radius (meters) , default 0.5-->
        <param name="gradient_end_radius" value="1" />    <!-- End of gradient zone (meters) -->
        <param name="max_cost" value="100" />               <!-- Maximum cost value -->
        
        <!-- Memory Parameters -->
        <param name="memory_duration" value="5.0" />   <!-- How long to remember obstacles (seconds) -->
    </node>

    <!-- ================================================================== -->
    <!-- RViz Visualization -->
    <!-- ================================================================== -->
    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find detector)/src/rviz.rviz" required="true"/>
    
</launch>